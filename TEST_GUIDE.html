<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Control Room - Feature Test Guide</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #0a0c12;
            color: #cbd5e1;
        }
        h1 { color: #818cf8; border-bottom: 2px solid #818cf8; padding-bottom: 10px; }
        h2 { color: #a78bfa; margin-top: 30px; }
        .test-box {
            background: rgba(99,102,241,0.08);
            border: 1px solid rgba(99,102,241,0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .test-step {
            background: rgba(255,255,255,0.03);
            padding: 10px;
            margin: 8px 0;
            border-left: 3px solid #22c55e;
            border-radius: 4px;
        }
        .feature { color: #4ade80; font-weight: bold; }
        .endpoint { background: rgba(99,102,241,0.15); padding: 2px 8px; border-radius: 4px; font-family: monospace; font-size: 13px; }
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #6366f1, #7c3aed);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            margin-top: 10px;
            font-weight: bold;
        }
        .btn:hover { background: linear-gradient(135deg, #7c3aed, #6366f1); }
        code { background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 3px; font-size: 13px; }
        .success { color: #4ade80; }
        .warning { color: #fbbf24; }
    </style>
</head>
<body>
    <h1>ğŸš€ Control Room - Complete Feature Test Guide</h1>
    
    <div class="test-box">
        <h2>âœ… Server Status</h2>
        <div class="test-step">
            <strong>Server should be running at:</strong> <code>http://localhost:8000</code><br>
            <strong>API Key:</strong> <span class="success">Loaded from .env</span><br>
            <strong>Custom Icons:</strong> <span class="success">Auto-detected</span>
        </div>
        <a href="http://localhost:8000" class="btn" target="_blank">ğŸŒ Open Control Room</a>
    </div>

    <h2>ğŸ§ª Testing Sequence</h2>

    <div class="test-box">
        <h3 class="feature">Feature 1: Company API Search</h3>
        <div class="test-step">
            <strong>Step 1:</strong> Go to <strong>ğŸ¢ Companies</strong> tab
        </div>
        <div class="test-step">
            <strong>Step 2:</strong> Enter <code>tesco</code> in Company Name field
        </div>
        <div class="test-step">
            <strong>Step 3:</strong> Click <strong>"Search API"</strong> button
        </div>
        <div class="test-step">
            <strong>Expected:</strong> List of Tesco companies appears, TESCO PLC shows up
        </div>
        <div class="test-step">
            <strong>Step 4:</strong> Click any result/marker on map
        </div>
        <div class="test-step">
            <strong>Expected:</strong> Popup shows with green "Live API Result" tag
        </div>
        <div class="test-step">
            <strong>Endpoint Used:</strong> <span class="endpoint">/ch/search/companies?q=tesco</span>
        </div>
    </div>

    <div class="test-box">
        <h3 class="feature">Feature 2: Custom Map Icons</h3>
        <div class="test-step">
            <strong>Check console:</strong> Should see <code class="success">âœ“ Custom icons loaded</code>
        </div>
        <div class="test-step">
            <strong>Markers on map:</strong> Should show building icons (not circles)
        </div>
        <div class="test-step">
            <strong>API results:</strong> Different colored icon than local search results
        </div>
        <div class="test-step">
            <strong>Fallback:</strong> If icons fail to load, automatically uses circle markers
        </div>
    </div>

    <div class="test-box">
        <h3 class="feature">Feature 3: View PSC (The Big One!)</h3>
        <div class="test-step">
            <strong>Step 1:</strong> Plot a company on map (e.g., search "bristol city fc")
        </div>
        <div class="test-step">
            <strong>Step 2:</strong> Click marker â†’ popup appears
        </div>
        <div class="test-step">
            <strong>Step 3:</strong> Click <strong>"View PSC"</strong> button in popup
        </div>
        <div class="test-step">
            <strong>Expected:</strong> Automatically switches to <strong>ğŸ‘¥ People</strong> tab
        </div>
        <div class="test-step">
            <strong>Expected:</strong> PSC cards displayed with beautiful formatting
        </div>
        <div class="test-step">
            <strong>Expected:</strong> <strong>"ğŸ“„ Download PDF"</strong> button appears at top
        </div>
        <div class="test-step">
            <strong>Endpoint Used:</strong> <span class="endpoint">/ch/company/{number}/persons-with-significant-control</span>
        </div>
    </div>

    <div class="test-box">
        <h3 class="feature">Feature 4: PDF Download</h3>
        <div class="test-step">
            <strong>Prerequisite:</strong> Complete Feature 3 to get PSC results displayed
        </div>
        <div class="test-step">
            <strong>Step 1:</strong> Click <strong>"ğŸ“„ Download PDF"</strong> button
        </div>
        <div class="test-step">
            <strong>Expected:</strong> PDF file downloads immediately
        </div>
        <div class="test-step">
            <strong>Filename:</strong> <code>PSC_{company_number}_{date}.pdf</code>
        </div>
        <div class="test-step">
            <strong>Contents:</strong>
            <ul>
                <li>Report title and company details</li>
                <li>Generation date/time</li>
                <li>Each PSC with full details (name, type, nationality, control types)</li>
                <li>Page numbers in footer</li>
            </ul>
        </div>
    </div>

    <div class="test-box">
        <h3 class="feature">Feature 5: Officer Search</h3>
        <div class="test-step">
            <strong>Step 1:</strong> Go to <strong>ğŸ‘¥ People</strong> tab
        </div>
        <div class="test-step">
            <strong>Step 2:</strong> Enter <code>John Smith</code> in Person / Officer Name field
        </div>
        <div class="test-step">
            <strong>Step 3:</strong> Leave Company Number field empty
        </div>
        <div class="test-step">
            <strong>Step 4:</strong> Click <strong>"ğŸ” Search API"</strong> button
        </div>
        <div class="test-step">
            <strong>Expected:</strong> List of officers named John Smith appears
        </div>
        <div class="test-step">
            <strong>Expected:</strong> Shows appointment count and address snippets
        </div>
        <div class="test-step">
            <strong>Endpoint Used:</strong> <span class="endpoint">/ch/search/officers?q=John+Smith</span>
        </div>
    </div>

    <div class="test-box">
        <h3 class="feature">Feature 6: Direct PSC Lookup</h3>
        <div class="test-step">
            <strong>Step 1:</strong> Go to <strong>ğŸ‘¥ People</strong> tab
        </div>
        <div class="test-step">
            <strong>Step 2:</strong> Enter <code>00445790</code> in Company Number field (Tesco PLC)
        </div>
        <div class="test-step">
            <strong>Step 3:</strong> Click <strong>"ğŸ” Search API"</strong>
        </div>
        <div class="test-step">
            <strong>Expected:</strong> PSC cards for Tesco appear
        </div>
        <div class="test-step">
            <strong>Expected:</strong> Download PDF button available
        </div>
        <div class="test-step">
            <strong>Try Other Companies:</strong>
            <ul>
                <li><code>03230871</code> - Bristol City FC</li>
                <li><code>08209948</code> - Various smaller companies</li>
            </ul>
        </div>
    </div>

    <div class="test-box">
        <h3 class="feature">Feature 7: UI Enhancements</h3>
        <div class="test-step">
            <strong>Tab Icons:</strong> ğŸ¢ Companies, ğŸ‘¥ People, ğŸ—ºï¸ Layers
        </div>
        <div class="test-step">
            <strong>Tooltips:</strong> Hover over tabs and buttons to see helpful hints
        </div>
        <div class="test-step">
            <strong>Help Text:</strong> Blue info box in People tab explains usage
        </div>
        <div class="test-step">
            <strong>PSC Cards:</strong> Color-coded tags (green for individual, orange for corporate)
        </div>
        <div class="test-step">
            <strong>Buttons:</strong> Enhanced with emojis (ğŸ” Search, ğŸ“„ Download)
        </div>
    </div>

    <h2>ğŸ¯ Quick Test Scenario</h2>
    <div class="test-box">
        <h3>Complete Journey (5 minutes)</h3>
        <ol>
            <li><strong>Search:</strong> Companies tab â†’ "bristol city fc" â†’ Search API</li>
            <li><strong>Plot:</strong> Click first result â†’ marker appears on map</li>
            <li><strong>View PSC:</strong> Click marker â†’ popup â†’ "View PSC" button</li>
            <li><strong>Switches:</strong> Auto-switches to People tab</li>
            <li><strong>Results:</strong> Beautiful PSC cards displayed</li>
            <li><strong>Download:</strong> Click "ğŸ“„ Download PDF" â†’ PDF saves</li>
            <li><strong>Open PDF:</strong> Verify professional formatting</li>
            <li><strong>Success! âœ…</strong></li>
        </ol>
    </div>

    <h2>ğŸ“Š What to Check</h2>
    <div class="test-box">
        <div class="test-step">
            <strong>Console (F12):</strong>
            <ul>
                <li class="success">âœ“ CH_API_KEY loaded: 138288ce...</li>
                <li class="success">âœ“ Custom icons loaded</li>
                <li class="success">Proxying: /ch/search/companies...</li>
                <li class="success">âœ“ Proxy success: 200</li>
            </ul>
        </div>
        <div class="test-step">
            <strong>Status Bar (Bottom):</strong> Shows "Ready â€” Live API search enabled âœ“"
        </div>
        <div class="test-step">
            <strong>Network Tab:</strong>
            <ul>
                <li>Should see calls to <code>/ch/search/companies</code></li>
                <li>Should see calls to <code>/ch/company/{number}/persons-with-significant-control</code></li>
                <li>All should return 200 status</li>
            </ul>
        </div>
    </div>

    <h2>ğŸ› Troubleshooting</h2>
    <div class="test-box">
        <div class="test-step">
            <strong class="warning">Icons show as circles:</strong><br>
            â†’ Normal fallback if PNG files not accessible<br>
            â†’ Functionality works perfectly, just visual difference
        </div>
        <div class="test-step">
            <strong class="warning">PSC no results:</strong><br>
            â†’ Some companies don't have PSC data (normal)<br>
            â†’ Try known companies like 00445790 (Tesco)
        </div>
        <div class="test-step">
            <strong class="warning">PDF not downloading:</strong><br>
            â†’ Check browser console for errors<br>
            â†’ Ensure jsPDF library loaded (check Network tab)
        </div>
        <div class="test-step">
            <strong class="warning">404 errors:</strong><br>
            â†’ Server may not have .env loaded<br>
            â†’ Restart server: <code>python scripts/dev_server.py</code>
        </div>
    </div>

    <h2>âœ¨ Bonus Features to Explore</h2>
    <div class="test-box">
        <ul>
            <li><strong>Quick Search:</strong> Use autocomplete search in Companies tab for instant suggestions</li>
            <li><strong>Layer Toggle:</strong> Turn on/off police areas, airports, etc. in Layers tab</li>
            <li><strong>Base Map:</strong> Switch between Dark, Grey, Street, Satellite views</li>
            <li><strong>Clustering:</strong> Zoom out to see company markers cluster together</li>
            <li><strong>Keyboard:</strong> Press Enter in any search field to execute</li>
        </ul>
    </div>

    <div style="text-align: center; margin-top: 40px; padding: 20px; background: rgba(99,102,241,0.1); border-radius: 8px;">
        <h2 class="success">ğŸ‰ All Features Ready!</h2>
        <p>Server is running. Everything is functional. Enjoy your enhanced Control Room!</p>
        <a href="http://localhost:8000" class="btn" target="_blank" style="font-size: 18px;">ğŸš€ Launch Control Room</a>
    </div>

    <footer style="margin-top: 40px; text-align: center; color: #64748b; font-size: 12px;">
        <p>Control Room Enhanced Edition â€¢ February 2026 â€¢ All systems operational</p>
    </footer>
</body>
</html>
