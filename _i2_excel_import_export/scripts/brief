ðŸ“Œ Task: Implement Companies House API Search & Mapping (Control Room)
Objective

Integrate live UK Companies House data into the Control Room map in a reliable, authoritative, and performant way, replacing local CSV / JSON subsets. The system must allow users to search for companies by multiple criteria, receive suggestions, and plot results on a Leaflet map using postcode geocoding.

Architecture (MANDATORY)

Do not call Companies House directly from the browser.

Use this flow:

Browser (Leaflet UI)
  â†’ Local API / Proxy (Node or Python)
    â†’ Companies House API (Basic Auth)


Reasons:

Companies House API does not allow CORS

API key must never be exposed client-side

Enables caching, throttling, and auditability

Authentication

Companies House uses HTTP Basic Auth:

Username: API key

Password: empty

Authorization header format:

Authorization: Basic base64(API_KEY:)


The API key must be:

stored in .env

excluded from version control

injected server-side only

Required API Endpoints

Implement wrappers for:

Search companies

GET https://api.company-information.service.gov.uk/search/companies?q={query}


Company profile

GET https://api.company-information.service.gov.uk/company/{company_number}

Local Proxy Requirements

Implement a lightweight local service (Flask or Express):

Endpoints:

GET /api/ch/search?q=
GET /api/ch/company/{company_number}


Responsibilities:

forward requests to Companies House

attach Basic Auth

return JSON unchanged

log errors clearly

optional: cache recent queries

Frontend Behaviour (Leaflet)

The frontend must:

Provide search inputs for:

Company name

Company number

(Optional) postcode or town

Perform as-you-type search suggestions using /api/ch/search

On selection:

fetch full company profile via /api/ch/company/{number}

extract registered office postcode

convert postcode â†’ lat/lon using existing lookup

plot marker on map

Markers must be:

visually distinct (companies layer)

popup shows:

company name

company number

address

status (if available)

Data Rules

Treat Companies House as a standalone intelligence source

Do not force correlation with:

airports

police forces

transport assets

No proximity logic unless explicitly requested later

Performance & UX

Limit suggestion results (e.g. 20)

Debounce typing (300â€“500ms)

Do not preload large datasets

Cache individual company lookups where possible

Security & Hygiene

.env in .gitignore

no API key in HTML or JS

fail gracefully on API errors

console-log errors during development

Deliverables

Local proxy service (Node or Python)

Clean frontend integration

No CSV or bulk JSON dependency

Map plotting verified using known companies (e.g. Bristol City FC Ltd)

Non-Goals (Explicit)

No bulk Companies House ingestion

No joins with transport or policing layers

No persistent storage

No analytics or dashboards

If you want, I can also give you:

a Node.js-only version of this brief

a test checklist for the agent

or a clean minimal map.js that only contains the CH logic