# i2 Specs Review Notes

## What is in this folder

- Directly parseable XML specs:
  - `.oimp` (8 import templates)
  - `.ximp` (5 example import templates)
  - `.cfs` (7 conditional formatting rule sets)
  - `Matching Settings/*.xml` (system + focused match rules)
  - `Offline Cache/Schema/InformationStore.dat` (full i2 schema XML)
- Structured but binary container:
  - `Report Specifications/Reporter.rep` (OLE/compound document)
- i2-native chart packages:
  - `.anb` files (example charts + worked examples)
- Spreadsheet sources:
  - `Entity Types.xlsx`
  - `Example 3.xls`
  - `Example 4.csv`

## Extracted assets now available

Generated by `scripts/extract_i2_specs.py` into `data/i2 Specs/parsed`:

- `schema_summary.json`
  - 54 entity types
  - 10 link types
- `import_specs_summary.json`
  - Full mapping breakdown for all `.oimp` templates
  - Includes required columns, property maps, identity rules, date formats, and preprocessing actions
- `matching_rules_summary.json`
  - 44 system match rules + 1 focused rule set
- `formatting_rules_summary.json`
  - 7 conditional formatting templates (targets/styles/parameters)

## High-value functionality to implement from these specs

1. Import Template Engine
- Use `.oimp` summaries as declarative templates for CSV/Excel ingestion.
- Implement preprocessing actions mirrored from i2:
  - `RemoveCharacters`
  - `ExtractText`
  - `ValuePrefix` / `ValueSuffix`
  - `ColumnSuffix`
- Respect date parsing formats from each template.

2. Entity/Link Identity & Dedup
- Use `ItemTypeIdentity` + match-rule logic as your dedup layer.
- Key normalizations to mirror:
  - `IGNORE_CASE`
  - `IGNORE_NONALPHANUMERIC`
  - `IGNORE_WHITESPACE_BETWEEN`
  - `IGNORE_WHITESPACE_AROUND`
  - `IGNORE_DIACRITICS`
  - `SIMPLIFY_LIGATURES`

3. Living Schema-backed UI
- Drive entity planners/forms directly from `schema_summary.json` + `InformationStore.dat`.
- Use i2 IDs (`ET*`, `LT*`, `PT*`, etc.) as canonical internal keys.
- Generate dynamic forms with mandatory flags and controlled value lists.

4. Chart Intelligence Layer
- Mirror `.cfs` logic for analytics-driven styling:
  - line width by transaction value
  - icon switch by inferred type (e.g., country flags for phone calling codes)
  - frame/label emphasis by centrality or lookup hits

5. Comms + Geo workflows
- The CDR templates show concrete patterns for:
  - A/B/C comms entity extraction
  - IMEI/IMSI extraction
  - call/event date-time normalization
  - synthetic GeoJSON generation from cell site coordinates

## Files likely requiring conversion

1. `.anb`
- Keep as reference unless you have an i2 automation/export route.
- Preferred conversion path: export chart content to CSV/JSON from i2, then ingest.

2. `.rep`
- OLE document with report templates; parsable with OLE tooling if needed.
- Recommended conversion: export report templates to XML/JSON for server-side report rendering.

3. `.xls` (`Example 3.xls`)
- Convert to UTF-8 CSV for stable ingestion.

4. `Entity Types.xlsx`
- Contains useful entity catalog text but currently not normalized row/column metadata.
- Best next step: transform to a clean table:
  - `entity_type_id`, `entity_name`, `property_id`, `property_name`, `mandatory`, `data_type`, `possible_values`

## Immediate next build step

Build an `i2-template-runner` module that reads `data/i2 Specs/parsed/import_specs_summary.json` and executes:

- column mapping
- transforms
- validation
- dedup/matching
- entity/link graph output

This gives you a true i2-style "living" ingestion and analysis backbone.
